- **What is MongoDB?**
    
    - MongoDB is a **document-oriented [[NoSQL]] database**. Unlike traditional SQL databases that store data in tables with rows and columns, MongoDB stores data in **documents** ([[Document-based NoSQL]].
- **Data Structure:**
    
    - Each record in MongoDB is a **document**, which is similar to **JSON objects** or **Python dictionaries**.
    - Documents are grouped into **collections**. For example, in a Campus Management system, student records are stored in a **students collection**, while staff records are in an **employees collection**.
- **Database Definition:**
    
    - A database is a structured collection of data. In the example, the Campus Management system uses a database called **CampusManagementDB**.
- **Document Breakdown:**
    
    - A document consists of **fields** or **properties** (e.g., first name, last name, email, student ID) with unique field names.
    - MongoDB supports various **data types**, allowing for flexibility in how data is stored (e.g., dates, numbers).
- **Flexibility and Schema:**
    
    - MongoDB allows for **schema-less** design, meaning you can change the structure of your documents as needed without altering tables, unlike traditional relational databases.
- **Data Types and Storage:**
    
    - Supports various data types, including:
        - **ISODate** for dates
        - Whole numbers and decimals for numerical data
    - Allows for **subdocuments** and **lists of values**, enabling complex data structures.
- **High Availability and Scalability:**
    
    - MongoDB provides **high availability** by maintaining multiple copies of data.
    - It supports **scalability**, allowing for vertical scaling (upgrading hardware) or horizontal scaling (partitioning data).
- **Use Cases:** MongoDB is suitable for applications that require 
	- Large and Unstructured
	- Complex
	- Flexible
	- Highly scalable application
	- Self-managed, Hybrid or Cloud Hosted
---
# Advantages
1. **Flexibility of Schema**:
    - MongoDB allows for a flexible schema, meaning that different documents in a collection can have different fields.
    - This is particularly useful for unstructured data, as it can accommodate varying data shapes without requiring predefined fields, unlike relational databases.
2. **Code-First Approach**:
    - Unlike relational databases that require a table design before data can be entered, MongoDB enables a code-first approach.
    - Users can start writing data immediately upon connecting to the database, simplifying the initial setup and eliminating the need for complex table definitions.
3. **Evolving Schema**:
    - MongoDB supports an evolving schema, allowing users to adapt their data structure as needs change.
    - For example, a courier company can easily add new fields to store information about contactless delivery without significant disruption.
4. **Querying and Analytics Capabilities**:
    - MongoDB uses Mongo Query Language (MQL), which offers various operators for building complex queries.
    - For more advanced data analysis, users can utilize aggregation pipelines to perform operations like grouping and filtering data.
5. **High Availability**:
    - MongoDB is designed for high availability through redundancy, typically using three-node replica sets.
    - If one node fails, another can take over, ensuring continuous operation and minimizing downtime, even during maintenance.
---
# Use Cases
- **Common Use Cases**: MongoDB is applicable in various scenarios, including:
    
    - **Many Sources – One View**: It allows integration of data from multiple sources, breaking down data silos. The flexible schema supports diverse data shapes and formats.
- **IoT Use Case**:
    
    - MongoDB can handle vast amounts of data generated by billions of IoT devices, such as weather stations that send frequent readings. Its scalability enables efficient storage and complex analysis of this data.
- **E-commerce Use Case**:
    
    - E-commerce platforms benefit from MongoDB's ability to manage products with varying attributes (e.g., phones vs. books). The document-oriented structure optimizes data storage for dynamic schemas, enhancing read performance.
- **Real-time Analytics Use Case**:
    
    - Organizations can leverage MongoDB for real-time data analysis, allowing them to respond to changes quickly without complex ETL processes. It supports both semi-structured and unstructured data.
- **Gaming Use Case**:
    
    - In the gaming industry, MongoDB's scalability (via sharding) is crucial for managing data across global multiplayer games, accommodating ever-changing data needs.
---
# CRUD
- **Mongo Shell Overview**:
    
    - The Mongo shell is a command-line tool for interacting with MongoDB databases, functioning as an interactive JavaScript interface.
    - To start, you connect to your MongoDB cluster using a connection string.
- **Database and Collections**:
    
    - After connecting, you can view all databases and select the campus management database.
    - The database contains two collections: staff and students.
- **CRUD Operations**:
    
    - **Create**:
        
        - Use the `insertOne` function to add a new document to the students' collection. The Mongo shell automatically generates an `_Id` field if not provided.
        - You can also use `insertMany` to add multiple documents at once.
        ![[mongodbcreate.png]]
        ![[InsertOperatorMongodb.png]]
    - **Read**:
        
        - The `findOne` function retrieves the first document without any filter.
        - You can find a specific student by email or retrieve all students with a certain last name using `find`.
        - The `count` function counts documents matching specific criteria.
        ![[queryOperatorMongodb4.png]]
        ![[queryOperatorMongodb3.png]]
    - **Update**:
        
        - Use `replaceOne` to update an entire document based on filter criteria.
        - For smaller changes, use `updateOne` with a `$set` operator to modify specific fields.
        - The `updateMany` function can update multiple documents at once.
        ![[queryOperatorMongodb.png]]
        ![[updateOperatorMongodb.png]]
        
    - **Delete**:
        - The `deleteOne` function removes a single document based on filter criteria, while `deleteMany` removes multiple documents.
        ![[deleteOperatorMongodb.png]]
---
# Indexes
- **MongoDB Indexing**:
    
    - MongoDB uses special data structures (Balanced Tree) to store indexes, which include the indexed fields and the document's location on disk.
    - Indexes are stored in a balanced tree format, allowing for efficient document retrieval, whether for equality or range searches.\
![[queryoperationmongodb2.png]]
![[queryoperationmongodb.png]]

---
# Aggregation
- **Aggregation Framework Overview**: This framework, also known as an aggregation pipeline, is a series of operations applied to data to achieve a desired outcome. It allows for complex data analysis.
    
- **Example Use Case**: To analyze student performance, you might want to calculate the average scores for courses in 2020. This involves filtering documents for the year 2020, grouping them by course ID, and calculating the average score.
    
- **Aggregation Stages**:
    
    - **$match**: Filters documents based on specified criteria (e.g., year 2020).
    - **$group**: Groups documents by a key (e.g., course ID) and performs calculations like average score.
    - **$project**: Reshapes documents by including or excluding fields.
    - **$sort**: Orders documents based on specified fields.
    - **$count**: Counts documents in a stage.
    - **$merge**: Stores output into a specified collection.
Example: Calculate the average score in 2020, group by course_id 
![[aggregateoperationmongodb3.png]]
Example: Project only two attribute and sort it descending on lastName column
![[aggregateoperationmongodb2.png]]
Example: Count the student 
![[aggregateoperationmongodb.png]]
- **Pipeline Processing**: Documents enter the pipeline, undergo various stages, and exit in the desired format.
    
- **Common Stages**: The video highlights the most commonly used stages in the aggregation pipeline, such as $project, $sort, and $merge.
    
- **Use Cases**: The aggregation framework can be used for various applications, including tracking student progress and analyzing sales data in e-commerce.
---
# Replication and Sharding
**Replication and Sharding in MongoDB:**
[[Distributed Database]]
1. **Replication:**
    - **Definition:** Replication is the process of duplicating data across multiple nodes in a MongoDB cluster.
    ![[Replication.png]]
    - **Benefits:**
        - Provides **redundancy**: Multiple copies of data ensure availability even if one server fails.
        - Enhances **fault tolerance** and **high availability** during hardware failures or maintenance.
    - **Mechanism:**
        - A typical MongoDB setup includes a **Replica Set** with three data-bearing nodes.
        - Data is written to the **primary node**, which then replicates changes to **secondary nodes**.
        - Changes are logged in the **Oplog** (operations log) of the primary node, and secondary nodes observe this log to apply updates.
    ![[ReplicationProcess.png]]
    - **Common Misconception:** Replication does not protect against disasters like accidental deletions; backups are necessary for disaster recovery.
2. **Sharding:**
    - **Definition:** Sharding is the process of partitioning data across multiple nodes to scale horizontally.
    - **Benefits:**
        - Increases **throughput** by directing queries to relevant shards.
        - Allows storage of more data than a single node can handle.
        - Enables data partitioning based on regions (e.g., US and European customers).
    - **Primary Node Role:** The primary node is the only one that can accept write operations. If it becomes unavailable, a new primary is elected from the secondary nodes.
3. **Election Process:**
    - An election occurs to select a new primary node when:
        - The current primary is unavailable.
        - A new replica set is initialized.
        - A manual failover is initiated for maintenance.
    - The node with the most recent data and minimal replication lag is preferred for election.
4. **Conclusion:**
    - Replication ensures data availability and redundancy but does not prevent data loss from human errors.
    - Sharding is essential for scaling databases to handle larger datasets and improve performance.
---
# MongoDb for [[Python]]
- **MongoClient**:
    - A class that facilitates interaction with MongoDB.
    - Imported from the `pymongo` library, which is the official MongoDB driver for Python.
    - The `uri` specifies the address of the MongoDB instance.
    - It is recommended to create the `MongoClient` instance only once in your code.
    ![[mongodblib.png]]
- **Database and Collection Access**:
    - After creating the `MongoClient`, you can access the desired database (e.g., Campus Management).
    - From the database, you can point to specific collections, such as the 'students' collection.
- **Creating Documents**:
    
    - To insert a single document, use the `insert_one` function.
    - For bulk inserts, use the `insert_many` function, which takes a list of documents.
    ![[Mongodbpythoncreate.png]]
    ![[Mongodbpythoncreate2.png]]
- **Read Operations**:
    - The `find_one` function retrieves the first document in natural order without any filter.
    - To find a specific document (e.g., a student with an email), `find_one` can be used with filter criteria.
    - The `find` function retrieves all documents that match specified criteria (e.g., students with the last name "Doe").
    - The `count` function can be used to count documents matching certain criteria.
    ![[Querymongodbpython.png]]
- **Cursor**:
    
    - When using `find`, a cursor is returned, which points to the documents in MongoDB.
    - To retrieve documents from the cursor, the `dumps` function can be used to exhaust the cursor.
    ![[PrintingCursor.png]]
- **Updating Documents**:
    - To update a document, you can create a new field or modify existing fields.
    - The `replace` function replaces the entire document based on filter criteria.
    ![[updateOperator.png]]
    - For smaller changes, in-place updates can be performed using the `$set` operator, which avoids retrieving the entire document.
	![[Mongodb_update.png]]
- **Bulk Updates**:
    - The `update_many` function can be used to update multiple documents at once, such as changing all students to "online only" during a lockdown.
- **Deleting Documents**:
    - The `delete_one` and `delete_many` functions are used to delete documents based on specified filter criteria.
    ![[deleteoperatormongodbpython.png]]